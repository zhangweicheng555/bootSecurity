<!DOCTYPE html>
<html>
  <head>
    <title>我的账单报销任务列表</title>
    <base href="#(basePath)"/>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    	<!-- 引入css -->
    	#@cssModel?()
  </head>
  
  <body>
	   
	   <div style="margin: 5px;">
	   		
	   		<!-- 搜索区域 -->
			<blockquote class="layui-elem-quote">
				<div>
					<button  id="addBtn" class="layui-btn layui-btn-small"><i class="layui-icon">&#xe654;</i></button>
					<button style="margin-left: 1px;" class="layui-btn layui-btn-small"><i class="layui-icon">&#xe642;</i></button>
					<button style="margin-left: 1px;" class="layui-btn layui-btn-small"><i class="layui-icon">&#xe640;</i></button>
				</div>
			</blockquote>
			<!-- 显示列表 -->
			<form class="layui-form" onsubmit="return false;">
				<table class="layui-table">
				  <colgroup><col width="2%"><col width="10%"><col width="15%"><col width="10%"><col width="10%"><col><col width="15%"></colgroup>
				  <thead>
				   	 <tr><th><input type="checkbox"  lay-skin="primary" lay-filter="allChoose"></th>
					 <th style="text-align: center;">任务名称</th>
					 <th style="text-align: center;">执行人</th>
					 <th style="text-align: center;">流程定义ID</th>
					 <th style="text-align: center;">流程实例ID</th>
					 <th style="text-align: center;">创建时间</th>
					 <th style="text-align: center;">操作</th></tr> 
				  </thead>
				  <tbody id="tbodymodel">
				  
				  </tbody>
				</table>
			</form>
  	   </div> 	
  	  		
  		
    	<!-- 引入js 这个要在自己的上面-->
    	#@jsModel?()
    	
    	<script type="text/javascript">
    		var common;var $;var layer;var form;var laypage;
			layui.config({base: "JFinalNew/js/"}).use(["layer","jquery","common","form"], function() {
				$ = layui.jquery;
			 	layer = layui.layer;
			    common = layui.common;
			    form = layui.form();
			    
			    $("#addBtn").click(function(){
			    	common.openEditDialog(load,"添加申请","childpayback/editPage.html","750px","350px",false,"childpayback/edit.html");
			    });
			    
			    /**全选*/
			     form.on("checkbox(allChoose)", function(data){
			      var child = $(data.elem).parents("table").find("tbody input[type='checkbox']");
			      child.each(function(index, item){
			          item.checked = data.elem.checked;
			      });
			      form.render('checkbox');
			    });
			    /**刷新跟初次加载数据*/
			    load();
			});
			
			 /**刷新跟初次加载数据*/
			function load(){
				$.ajax({
			    	   type: "POST",url: "childpayback/queryMyTask.html",dataType: "JSON",data: {},
			    	   success: function(msg){
			    		   console.info(msg);
			    		   /**第一次加载数据*/
						    loadData(msg);
			    	   }
			    });
			 }
			//加载数据
			function loadData(list){
				$("#tbodymodel").empty();
				var html="";
				if(list.length==0){
						html +='<tr><td></td><td colspan="5" style="text-align: center;color: red;">暂无数据</td><td></td></tr>';
				}else{
					for(var i=0;i<list.length;i++){
						var data=list[i];
						html +='<tr><td><input   type="checkbox" lay-skin="primary" id="'+data.taskId+'"></td><td style="text-align: center;">'+data.taskName+'</td><td style="text-align: center;">'+data.assigneeName+'</td><td style="text-align: center;">'+data.pdid+'</td><td style="text-align: center;">'+data.piid+'</td><td style="text-align: center;">'+data.createTime+'</td><td style="text-align: center;"><button onclick="applyBtn(this)"  lang="'+data.taskId+'"  style="height: 25px;line-height:25px;" class="layui-btn layui-btn-small  layui-btn-danger">完成任务</button><button onclick="viewPic(this)"  lang="'+data.taskId+'"  style="height: 25px;line-height:25px;margin-top: 3px;" class="layui-btn layui-btn-small  layui-btn-danger">查看流程</button></td></tr>';
					}
				}
				$("#tbodymodel").append(html);
				form.render('checkbox');
			}
			 /**处理任务*/
			function applyBtn(record){
				 var id=$(record).attr("lang");
				 if(id){
					common.openEditDialog(load,"处理任务","childpayback/dealTaskPage.html?id="+id,"750px","450px",false,"childpayback/dealTask.html");
				 }else{
					 common.getMsgBlackDialog("请选中要完成的任务",1500);
				 }
			}
			 /**查看流程图*/
			 function viewPic(record){
				 var id=$(record).attr("lang");
				 common.openEditDialogView("查看流程图","childpayback/viewPicPage.html?id="+id,"950px","530px",false);
			 }
  		</script>
  </body>
</html>
