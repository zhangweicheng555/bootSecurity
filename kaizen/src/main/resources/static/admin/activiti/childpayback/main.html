<!DOCTYPE html>
<html>
  <head>
    <title>我的账单报销申请列表</title>
    <base href="#(basePath)"/>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    	<!-- 引入css -->
    	#@cssModel?()
  </head>
  
  <body>
	   
	   <div style="margin: 5px;">
	   		
	   		<!-- 搜索区域 -->
			<blockquote class="layui-elem-quote">
				<div>
					<button  id="addBtn" class="layui-btn layui-btn-small"><i class="layui-icon">&#xe654;</i></button>
					<button style="margin-left: 1px;" class="layui-btn layui-btn-small"><i class="layui-icon">&#xe642;</i></button>
					<button style="margin-left: 1px;" class="layui-btn layui-btn-small"><i class="layui-icon">&#xe640;</i></button>
				</div>
			</blockquote>
			<!-- 显示列表 -->
			<form class="layui-form" onsubmit="return false;">
				<table class="layui-table">
				  <colgroup><col width="2%"><col width="10%"><col width="15%"><col width="10%"><col width="10%"><col><col width="10%"></colgroup>
				  <thead>
				    <tr><th><input type="checkbox"  lay-skin="primary" lay-filter="allChoose"></th><th style="text-align: center;">申请人</th><th style="text-align: center;">申请时间</th><th style="text-align: center;">报销钱数</th><th style="text-align: center;">审核状态</th><th style="text-align: center;">备注</th><th style="text-align: center;">操作</th></tr> 
				  </thead>
				  <tbody id="tbodymodel">
				    
				  </tbody>
				</table>
			</form>
			<!-- 分页显示区域 -->
			<div id="demo7" style="float: right;"></div>
  	   </div> 	
  	  		
  		
    	<!-- 引入js 这个要在自己的上面-->
    	#@jsModel?()
    	
    	<script type="text/javascript">
    		var common;var $;var layer;var form;var laypage;
			layui.config({base: "JFinalNew/js/"}).use(["layer","jquery","common","form","laypage"], function() {
				$ = layui.jquery;
			 	layer = layui.layer;
			    common = layui.common;
			    form = layui.form();
			    laypage = layui.laypage;
			    
			    /**添加*/
			    $("#addBtn").click(function(){
			    	common.openEditDialog(load,"添加申请","childpayback/editPage.html","750px","350px",false,"childpayback/edit.html");
			    });
			    
			    /**全选*/
			     form.on("checkbox(allChoose)", function(data){
			      var child = $(data.elem).parents("table").find("tbody input[type='checkbox']");
			      child.each(function(index, item){
			          item.checked = data.elem.checked;
			      });
			      form.render('checkbox');
			    });
			    /**刷新跟初次加载数据*/
			    load();
			});
			
			 /**刷新跟初次加载数据*/
			function load(){
				$.ajax({
			    	   type: "POST",url: "childpayback/queryList.html",dataType: "JSON",data: {},
			    	   success: function(msg){
			    		   /**初始化分页*/
						    laypage({
						        cont: "demo7",pages: msg.totalPage,skip: true,curr:msg.pageNumber,groups:6,
						        jump: function(obj, first){
						        	if(!first){
							        	var curr = obj.curr;
							        	$.ajax({
							        		 type: "POST",url: "childpayback/queryList.html",dataType: "JSON",data: {page:curr},
							        		   success: function(msg){
							        			   loadData(msg.list);
							        		   }
							        	});
						        	}
						        }
						    });
			    		   /**第一次加载数据*/
						    loadData(msg.list);
			    	   }
			    });
			 }
			//加载数据
			function loadData(list){
				$("#tbodymodel").empty();
				var html="";
				if(list.length==0){
						html +='<tr><td></td><td colspan="5" style="text-align: center;color: red;">暂无数据</td><td></td></tr>';
				}else{
					for(var i=0;i<list.length;i++){
						var data=list[i];
						html +='<tr><td><input   type="checkbox" lay-skin="primary" id="'+data.id+'"></td><td style="text-align: center;">'+data.uname+'</td><td style="text-align: center;">'+data.timedate+'</td><td style="text-align: center;">'+data.moneynum+'</td><td style="text-align: center;">'+data.flagName+'</td><td style="text-align: center;">'+data.remark+'</td><td style="text-align: center;"><button onclick="applyBtn(this)"  lang="'+data.id+'"  style="height: 25px;line-height:25px;" class="layui-btn layui-btn-small  layui-btn-danger">提交申请</button></td></tr>';
					}
				}
				$("#tbodymodel").append(html);
				form.render('checkbox');
			}
			/**申请按钮*/
			function applyBtn(record){
				common.getConfirmDelDialog("友情提示","确认提交?",5,"childpayback/submitApply.html",{id:$(record).attr("lang")},load);
			}
  		</script>
  </body>
</html>
