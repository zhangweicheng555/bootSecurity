<!DOCTYPE html>
<html>
  <head>
    <title>资源管理</title>
    <base href="#(basePath)"/>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    	<!-- 引入css -->
    	#@cssModel?()
  </head>
  
  <body class="easyui-layout">
  
  		<div data-options="region:'north',border:false">
	    	<div style="float: left;padding-left: 4px;">
				  <div class="layui-input-inline" title="展开全部"><button  id="expandAll"  class="layui-btn   layui-btn-warm layui-btn-small"   style="margin-left: 1px;"><i class="layui-icon">&#xe624;</i>展开全部</button></div>
				  <div class="layui-input-inline" title="折叠全部"><button  id="closeAll"  class="layui-btn    layui-btn-small"   style="margin-left: 1px;"><i class="layui-icon">&#xe61d;</i>折叠全部</button></div>
				  <div class="layui-input-inline" title="清除缓存"><button  id="clearCache"  class="layui-btn    layui-btn-small"   style="margin-left: 1px;"><i class="layui-icon">&#xe639;</i>清除缓存</button></div>
	    	</div>
	    	<div style="text-align: right;float: right"  class="layui-input-inline">
	    		
	    		<div class="layui-btn-group">
				  <button id="add" class="layui-btn  layui-btn-small"><i class="layui-icon">&#xe654;</i></button>
				  <button id="update" class="layui-btn  layui-btn-small"><i class="layui-icon">&#xe642;</i></button>
				  <button id="delete" class="layui-btn  layui-btn-small"><i class="layui-icon">&#xe640;</i></button>
				</div>
	    	</div>
	    </div>   
	    
	    <div data-options="region:'center',border:false" style="margin-top: 2px;">
	     	 <table id="datagridModel" ></table> 
	    </div> 
  		
  		
  		
  		<!-- 导出专用 -->
  		<form  id="exportForm"  action="dyjl/export.html" method="post">
	    	<input type="text"  name="stationName" id="stationNameM" >
	    	<input type="text"  name="stationType" id="stationTypeM" >
	    	<input type="text"  name="person1" id="person1M" >
	    	<input type="text"  name="createDate" id="createDateM" >
	    </form>
  		
  		
    	<!-- 引入js 这个要在自己的上面-->
    	#@jsModel?()
    	
    	<script type="text/javascript">
			layui.config({base: "JFinalNew/js/"}).use(["layer","jquery","common"], function() {
				var $ = layui.jquery;
				var layer = layui.layer;
				var common = layui.common;
				
				
				
				var datagrid;	
				var selectId;/**记录选中的id*/			
				$(function(){
					datagrid=$("#datagridModel").treegrid({    
					    url:"sysresource/queryList.html",  
					    idField:"id",
					    treeField:"name",  
					     columns:[[    
					         {field:"id",title:"编号",width:100,checkbox:true},  
					         {field:"name",title:"资源名称",width:300},   
					         {field: "icon", title: '图标 ', width: 90, fixed:true,align: 'center'},
					         {field: "url", title:  '资源链接', width: 150,fixed:true, align: 'center'},
					         {field: "insertdate", title:  '添加时间', fixed:true,width: 170, align: 'center'},
					         {field: "updatedate", title:  '更新时间', fixed:true,width: 170, align: 'center'},
					         {field: "parentname", title:  '父节点',fixed:true, width: 140, align: 'center'},
					         {field: "sort", title:  '排序', width: 100, align: 'center'},
					         {field: "remark", title:  '描述', width: 400, align: 'center'}
					    ]],
					    autoRowHeight:false,
					    fitColumns: true,
					    striped:true,
					    nowrap:true,
					    loadMsg:"拼命加载中...",
					    singleSelect:false,
					    checkOnSelect:true,
					    selectOnCheck:true,
					    fit:true,
					    onClickRow:function(row){
					    	datagrid.treegrid("unselectAll");
					    	if(row.id == selectId){
					    		selectId="";
					    	}else{
					    		selectId=row.id;
					    		datagrid.treegrid("select",row.id);
					    	}
					    }
					}); 
				});
				
				/**展开全部*/
				$("#expandAll").click(function(){
					expandAll();
				});
				/**折叠全部*/
				$("#closeAll").click(function(){
					datagrid.treegrid("collapseAll");
					datagrid.treegrid("unselectAll");
				});
				
				
			
				/**添加*/
				$("#add").click(function(){
					var rows=datagrid.treegrid("getSelections");
					var url="sysresource/editPage.html";
					if(rows.length >0){
						if(rows.length !=1){
							common.getMsgBlackDialog("请选中一个父节点...",2000);
							return ;
						}else{
							/**判断可不可以添加*/
							$.ajax({
							   type: "POST",url: "sysresource/isThreeNode.html",data: {id:rows[0].id},dataType: "json",
							   success: function(msg){
							   	   if(msg.success){
									   url=url+"?id="+rows[0].id;
									   common.openEditDialog(expandAll,"添加资源",url,"750px","480px",false,"sysresource/edit.html");
							   	   }else{
							   	   		common.getMsgBlackDialog("不可以再添加节点了...",2000);
							   	   		datagrid.treegrid("unselectAll");
							   	   		return ;
							   	   }
							   }
							});
						}
					}else{
							common.openEditDialog(expandAll,"添加资源",url,"750px","480px",false,"sysresource/edit.html");
					}
				});
			
				/**修改*/
				$("#update").click(function(){
					var rows=datagrid.treegrid("getSelections");
					if(rows.length !=1){
						common.getMsgBlackDialog("请选中要修改的一条记录",2000);
						return ;
					}
					common.openEditDialog(expandAll,"资源修改","sysresource/editPageEdit.html?id="+rows[0].id,"750px","480px",false,"sysresource/edit.html");
				});
				
				/**删除*/
				$("#delete").click(function(){
					var rows=datagrid.treegrid("getSelections");
					if(rows.length == 0){
						common.getMsgBlackDialog("请选中要删除的记录",2000);
						return ;
					}
					var ids=[];
					for(var i=0;i<rows.length;i++){
						ids.push(rows[i].id);
					}
					common.getConfirmDelDialog("友情提示","确定要删除该记录以及子记录吗？",3,"sysresource/delete.html",{ids:ids.join(",")},expandAll);
				});
				
				/**清除缓存*/
				$("#clearCache").click(function(){
					common.clearCacheOperate("sysresource/clearCache.html",reload);
				});
				/**重载所有的行*/
				function reload(){
					datagrid.treegrid("reload");
				}
				
				/**展开全部*/
				function expandAll(){
					datagrid.treegrid("expandAll");
					datagrid.treegrid("unselectAll");
				}
			});
  		</script>
  </body>
</html>
